<!DOCTYPE html>
<html lang="en">

<head>
    <title>Getting Started with ml5.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>
</head>

<body>
    <canvas id="canvas" width="400" height="400"></canvas>
    <button id="trainBtn">Train Model</button>
    <script>
        let options = {
            inputs: ['x', 'y'],
            outputs: ['label'],
            task: 'classification',
            debug: 'true'
        };
        let model = ml5.neuralNetwork(options);
        const canvas = document.getElementById('canvas');
        const trainBtn = document.getElementById('trainBtn');
        const ctx = canvas.getContext("2d");
        trainBtn.addEventListener('click', train);
        document.addEventListener('keydown', keyPressed);
        canvas.addEventListener('mousedown', drawCircle);
        let state = 'collection';
        let targetLabel = 'C';
        function keyPressed(e) {
            targetLabel = e.key.toUpperCase();
        }
        function drawCircle(e) {
            const x = e.clientX;
            const y = e.clientY;
            let inputs = {
                x: x,
                y: y
            };
            if (state === 'collection') {
                let target = {
                    label: targetLabel
                }
                console.log(target)
                model.addData(inputs, target);
                const radius = 20;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = "white";
                ctx.fill();
                ctx.lineWidth = 1;
                ctx.fillStyle = "black";
                ctx.font = "20px arial";
                ctx.fillText(targetLabel, x - 6, y + 8)
                ctx.stroke();
                ctx.closePath();
            } else if (state === 'prediction') {
                console.log(inputs)
                model.classify(inputs, handleResults);
            }
        }
        function handleResults(error, results) {
            if (error) {
                console.error(error);
                return;
            }
            console.log(results)
        }
        function whileTraining(epoch, loss) {
            console.log(epoch, loss)
        }
        function finishedTraining() {
            console.log('Finished Training')
            state = 'prediction';
        }
        function train() {
            console.log("Training Started");
            state = 'training'
            model.normalizeData();
            let options = {
                epochs: 200
            }
            model.train(options, whileTraining, finishedTraining);
        }
    </script>
</body>

</html>

<style>
    #canvas {
        border: 3px red dashed;
    }
</style>